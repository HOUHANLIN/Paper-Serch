<!doctype html>
<html lang="zh-CN" data-theme="light">

<head>
  <meta charset="utf-8" />
  <title>Paper-Serch Â· è‡ªåŠ¨å·¥ä½œæµ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script>
    (() => {
      const saved = localStorage.getItem('ps-theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.documentElement.dataset.theme = saved || (prefersDark ? 'dark' : 'light');
    })();
  </script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
</head>

<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="{{ url_for('index') }}" class="brand-mark">
        <span class="dot"></span>
        <div>
          <div class="brand-sub">Paper-Serch</div>
          <div class="brand-title">Literature &amp; AI summaries</div>
        </div>
      </a>
      <nav class="nav-links">
        <a href="{{ url_for('index') }}">é¦–é¡µ</a>
        <a href="{{ url_for('workflow') }}" aria-current="page">è‡ªåŠ¨å·¥ä½œæµ</a>
        <a href="{{ url_for('tutorial') }}">ä½¿ç”¨æ•™ç¨‹</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <section class="hero container">
      <div class="hero-text">
        <p class="eyebrow">æ–¹å‘æ‹†è§£ Â· æ‰¹é‡æ•´ç†</p>
        <h1>è‡ªåŠ¨åˆ†æ–¹å‘æ£€ç´¢ä¸æ‘˜è¦</h1>
        <p class="lede">å°†é•¿æ–‡æœ¬ä¸€é”®æ‹†è§£æˆå¤šä¸ªæ£€ç´¢æ–¹å‘ï¼Œè‡ªåŠ¨ç”Ÿæˆæ£€ç´¢å¼ã€è·å–æ–‡çŒ®å¹¶è¾“å‡º BibTeXã€‚</p>
      </div>
      <div class="hero-status-module glass" id="hero-status-card">
        <div class="status-header-row">
          <div class="card-kicker">SYSTEM STATUS</div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="status-indicator" id="hero-status-indicator">
              <span class="dot"></span>
              <span id="hero-state-text">å‡†å¤‡å°±ç»ª</span>
              <span class="muted" id="hero-elapsed-text" style="font-size: 12px; margin-left: 4px;">00:00</span>
              <span class="muted" id="hero-progress-text" style="font-size: 12px; margin-left: 6px;">0/4</span>
            </div>
            <button class="status-toggle-btn" onclick="toggleStatusModule()" title="å±•å¼€/æ”¶èµ·è¯¦æƒ…">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 9l6 6 6-6" />
              </svg>
            </button>
          </div>
        </div>
        <ul class="hero-status-list" id="status-list">
          <li class="status-item" id="status-placeholder">
            <span class="status-icon pending">â€¦</span>
            <div>
              <strong>ç­‰å¾…å¼€å§‹</strong>
              <p class="muted">æäº¤ååœ¨æ­¤æ˜¾ç¤ºä»»åŠ¡åˆ†è§£ä¸æŠ“å–è¿›åº¦ã€‚</p>
            </div>
          </li>
        </ul>
      </div>
    </section>

    <form id="workflow-form" method="post" class="container workflow-layout">
      <!-- Configuration Sidebar -->
      <aside class="workflow-settings stack">
        <details class="card settings-collapsible" open>
          <summary class="card-head">
            <div>
              <p class="card-kicker">CONFIGURATION</p>
              <h2>é…ç½®ä¸å·¥å…·</h2>
            </div>
          </summary>

          <div class="settings-content stack">
            <div class="field-group">
              <label for="ai_provider">AI æ¨¡å‹</label>
              <select id="ai_provider" name="ai_provider">
                <option value="openai" {% if form.ai_provider=='openai' or not form.ai_provider %}selected{% endif %}>
                  OpenAI</option>
                <option value="gemini" {% if form.ai_provider=='gemini' %}selected{% endif %}>Gemini</option>
                <option value="ollama" {% if form.ai_provider=='ollama' %}selected{% endif %}>
                  Ollama</option>
              </select>
            </div>

            {% for provider_name in ['ollama', 'openai', 'gemini'] %}
            <div class="provider-panel" data-provider="{{ provider_name }}">
              {% if provider_name == 'ollama' %}
              <div class="field-inline"><label for="ollama_api_key">API Key</label><input id="ollama_api_key"
                  name="ollama_api_key" type="text" value="{{ form.ollama_api_key }}" placeholder="é»˜è®¤ ollama" /></div>
              <div class="field-inline"><label for="ollama_base_url">Base URL</label><input id="ollama_base_url"
                  name="ollama_base_url" type="text" value="{{ form.ollama_base_url }}"
                  placeholder="é»˜è®¤ http://localhost:11434/v1" /></div>
              <div class="field-inline"><label for="ollama_model">æ¨¡å‹åç§°</label><input id="ollama_model"
                  name="ollama_model" type="text" value="{{ form.ollama_model }}" placeholder="é»˜è®¤ llama3.1" /></div>
              {% elif provider_name == 'openai' %}
              <div class="field-inline"><label for="openai_api_key">API Key</label><input id="openai_api_key"
                  name="openai_api_key" type="text" value="{{ form.openai_api_key }}" placeholder="ç•™ç©ºè¯»å–ç¯å¢ƒå˜é‡" /></div>
              <div class="field-inline"><label for="openai_base_url">Base URL</label><input id="openai_base_url"
                  name="openai_base_url" type="text" value="{{ form.openai_base_url }}" placeholder="å…¼å®¹è‡ªæ‰˜ç®¡æ¥å£" /></div>
              <div class="field-inline"><label for="openai_model">æ¨¡å‹åç§°</label><input id="openai_model"
                  name="openai_model" type="text" value="{{ form.openai_model }}" placeholder="é»˜è®¤ gpt-4o-mini" /></div>
              {% elif provider_name == 'gemini' %}
              <div class="field-inline"><label for="gemini_api_key">API Key</label><input id="gemini_api_key"
                  name="gemini_api_key" type="text" value="{{ form.gemini_api_key }}" placeholder="ç•™ç©ºè¯»å–ç¯å¢ƒå˜é‡" /></div>
              <div class="field-inline"><label for="gemini_model">æ¨¡å‹åç§°</label><input id="gemini_model"
                  name="gemini_model" type="text" value="{{ form.gemini_model }}" placeholder="é»˜è®¤ gemini-2.5-flash" />
              </div>
              {% endif %}
            </div>
            {% endfor %}

            <hr class="separator" />

            <div class="field">
              <label for="source">æ–‡çŒ®æ•°æ®æº</label>
              <select id="source" name="source">
                {% for source in sources %}
                <option value="{{ source.name }}" {% if form.source==source.name %}selected{% endif %}>{{
                  source.display_name }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="field-row">
              <div class="field">
                <label for="years">å¹´ä»½</label>
                <input id="years" name="years" type="number" min="1" max="50" value="{{ form.years }}" />
              </div>
              <div class="field">
                <label for="max_results">æ¡æ•°/æ–¹å‘</label>
                <input id="max_results" name="max_results" type="number" min="1" max="50"
                  value="{{ form.max_results or 5 }}" />
              </div>
            </div>

            <div class="field">
              <label class="switch">
                <input type="checkbox" id="toggle-contact" />
                <span>é«˜çº§å‚æ•° (Email/API)</span>
              </label>
            </div>

            <div id="contact-fields" style="display:none;" class="stack">
              <div class="field"><label for="email">è”ç³»é‚®ç®±</label><input id="email" name="email" type="text"
                  value="{{ form.email }}" /></div>
              <div class="field"><label for="api_key">API Key</label><input id="api_key" name="api_key" type="text"
                  value="{{ form.api_key }}" /></div>
            </div>
          </div>
        </details>
      </aside>

      <!-- Main Workspace Area -->
      <div class="workflow-main stack">
        <div class="card workspace-card">
          <div class="card-head">
            <div>
              <p class="card-kicker">WORKSPACE</p>
              <h2>æ‹†è§£å†…å®¹å¹¶æ£€ç´¢</h2>
            </div>
          </div>
          <div class="field">
            <textarea id="direction-text" name="direction_text" placeholder="ç²˜è´´ç ”ç©¶èƒŒæ™¯æˆ–è¯´æ˜æ–‡å­—ï¼ŒAI å°†è‡ªåŠ¨æ‹†è§£æ–¹å‘å¹¶æ£€ç´¢..."
              class="large-input"></textarea>
          </div>
          <div class="generator-actions">
            <button class="btn primary" id="btn-auto-workflow" type="button">ä¸€é”®æ‹†è§£å¹¶æ£€ç´¢</button>
            <div class="direction-output">
              <ul id="direction-list" class="direction-list"></ul>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-head">
            <div>
              <p class="card-kicker">PAPERS</p>
              <h2>æ–‡çŒ®åˆ—è¡¨</h2>
            </div>
          </div>
          <div id="article-container" class="article-list">
            {% if articles %}
            {% for article in articles %}
            <article class="paper" id="paper-{{ article.pmid or loop.index }}">
              <header class="paper-head">
                <h3>
                  {% if article.url %}
                  <a href="{{ article.url }}" target="_blank" rel="noreferrer">{{ article.title }}</a>
                  {% else %}
                  {{ article.title }}
                  {% endif %}
                </h3>
                <div class="meta">{{ article.authors }} Â· {{ article.journal }} Â· {{ article.year }} {% if article.pmid
                  %}<span class="badge">PMID: {{ article.pmid }}</span>{% endif %} {% if article.direction %}<span
                    class="badge muted">{{ article.direction }}</span>{% endif %}</div>
              </header>

              <div class="paper-details visible">
                {% if article.summary_zh %}
                <div class="ai-content-box">
                  <div class="card-kicker">âœ¨ å…¨æ–‡æ¦‚æ‹¬</div>
                  <p class="paper-summary">{{ article.summary_zh }}</p>
                </div>
                {% endif %}
                {% if article.usage_zh %}
                <div class="ai-content-box usage">
                  <div class="card-kicker">ğŸ¯ å¼•ç”¨å»ºè®®</div>
                  <p class="paper-summary">{{ article.usage_zh }}</p>
                </div>
                {% endif %}
                {% if not article.summary_zh and not article.usage_zh %}
                <p class="muted">æš‚æ—  AI æ€»ç»“</p>
                {% endif %}
              </div>
            </article>
            {% endfor %}
            {% else %}
            <div class="muted">æäº¤åå°†åœ¨æ­¤å±•ç¤ºæ£€ç´¢åˆ°çš„æ–‡çŒ®åˆ—è¡¨ã€‚</div>
            {% endif %}
          </div>
        </div>

        <div class="card bibtex-consolidated glass">
          <div class="card-head">
            <div>
              <p class="card-kicker">OUTPUT</p>
              <h2>BibTeX ç»“æœ</h2>
            </div>
            <div class="actions-right">
              <span class="muted" id="result-count">å…± {{ count }} æ¡</span>
              <button class="btn ghost btn-sm" type="button" id="copy-btn" {% if not bibtex_text %}disabled{% endif
                %}>å¤åˆ¶</button>
              <button class="btn subtle btn-sm export-btn" type="submit" formaction="/download" {% if not bibtex_text
                %}disabled{% endif %}>å¯¼å‡ºæ–‡ä»¶</button>
            </div>
          </div>
          <textarea id="bibtex-output" class="bibtex-output mini" readonly>{{ bibtex_text }}</textarea>
          <textarea id="bibtex-hidden" form="workflow-form" name="bibtex_text" hidden>{{ bibtex_text }}</textarea>
        </div>
      </div>
    </form>

    <footer class="footer">
      <div class="container">
        <p class="muted">WORKFLOW PREVIEW</p>
        <p>è‡ªåŠ¨æ‹†è§£ã€æ£€ç´¢ä¸æ‘˜è¦ç”Ÿæˆå‡åœ¨æœ¬åœ°è¯·æ±‚é“¾è·¯å†…æ‰§è¡Œï¼Œä¸ä¿å­˜è¾“å…¥å†…å®¹ã€‚</p>
      </div>
    </footer>
  </main>

  <script>
    window.sourceDefaults = {{ source_defaults | tojson }};
    window.initialStatusLog = {{ status_log | tojson }};
  </script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>
